<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paharpur Advance Recommendation System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
        }
        
        .material-preview {
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        
        .material-preview:hover {
            transform: rotate3d(1, 1, 0, 15deg);
        }

        .package-3d {
            perspective: 1000px;
            transition: all 0.3s;
        }

        .package-3d:hover {
            transform: scale(1.05);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .material-layer {
            height: 30px;
            margin: 2px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .packaging-type-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .packaging-type-card:hover {
            transform: translateY(-5px);
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .compare-table th, .compare-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .compare-table th {
            background-color: #f3f4f6;
        }
        
        .packaging-preview {
            transition: all 0.5s;
            transform-style: preserve-3d;
        }
        
        .packaging-preview:hover {
            transform: rotateY(10deg);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow: auto;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        .gemini-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .gemini-chat-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
        }

        .gemini-message {
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 85%;
        }

        .gemini-user {
            background-color: #e2f1ff;
            color: #0a558c;
            margin-left: auto;
        }

        .gemini-assistant {
            background-color: #f0f0f0;
            color: #333;
            margin-right: auto;
        }

        .typing-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            margin: 0 2px;
            border-radius: 50%;
            background-color: #888;
            animation: typing 1.5s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        /* Pouch Generator Specific Styles */
        .pouch-preview-container {
            perspective: 1000px;
        }
        
        .pouch-preview {
            transform-style: preserve-3d;
            transition: transform 0.8s;
        }
        
        .pouch-preview:hover {
            transform: rotateY(15deg) rotateX(5deg);
        }
        
        .dimension-line {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
        
        .dimension-label {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-50" x-data="app()">
    <div class="min-h-screen">
        <!-- Navigation Bar -->
        <nav class="bg-blue-800 text-white p-4 shadow-lg">
            <div class="container mx-auto flex flex-wrap justify-between items-center">
                <div class="flex items-center">
                    <i class="bi bi-box-seam text-3xl mr-3"></i>
                    <h1 class="text-2xl font-bold">Paharpur Advance Recommendation System</h1>
                </div>
                <div class="flex flex-wrap space-x-2 md:space-x-4 mt-2 md:mt-0">
                    <button class="bg-blue-600 px-3 md:px-4 py-2 rounded hover:bg-blue-700 transition flex items-center text-sm md:text-base" id="newAnalysis">
                        <i class="bi bi-plus-circle mr-1"></i> New Analysis
                    </button>
                    <button class="bg-green-600 px-3 md:px-4 py-2 rounded hover:bg-green-700 transition flex items-center text-sm md:text-base" id="compareBtn">
                        <i class="bi bi-bar-chart mr-1"></i> Compare Materials
                    </button>
                    <button class="bg-purple-600 px-3 md:px-4 py-2 rounded hover:bg-purple-700 transition flex items-center text-sm md:text-base" id="sustainabilityBtn">
                        <i class="bi bi-leaf mr-1"></i> Sustainability
                    </button>
                    <button class="bg-orange-600 px-3 md:px-4 py-2 rounded hover:bg-orange-700 transition flex items-center text-sm md:text-base" @click="openGeminiModal()">
                        <i class="bi bi-robot mr-1"></i> AI Assistant
                    </button>
                    <button class="bg-pink-600 px-3 md:px-4 py-2 rounded hover:bg-pink-700 transition flex items-center text-sm md:text-base" @click="openPouchGeneratorModal()">
                        <i class="bi bi-box mr-1"></i> Pouch Generator
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container mx-auto p-4">
            <!-- Packaging Type Selection -->
            <div class="mb-6">
                <h2 class="text-xl font-bold mb-4">Select Packaging Type</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center active border-2 border-blue-500" data-type="pouches">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-blue-100 rounded-full mb-2">
                            <i class="bi bi-bag text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Pouches</h3>
                    </div>
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center" data-type="laminates">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-green-100 rounded-full mb-2">
                            <i class="bi bi-layers text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Laminates</h3>
                    </div>
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center" data-type="shrinkSleeves">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-purple-100 rounded-full mb-2">
                            <i class="bi bi-box text-purple-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Shrink Sleeves</h3>
                    </div>
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center" data-type="flexibleFilms">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-yellow-100 rounded-full mb-2">
                            <i class="bi bi-film text-yellow-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Flexible Films</h3>
                    </div>
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center" data-type="standUpPouches">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-red-100 rounded-full mb-2">
                            <i class="bi bi-bag-fill text-red-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Stand-Up Pouches</h3>
                    </div>
                    <div class="packaging-type-card bg-white p-4 rounded-lg shadow-md text-center" data-type="lidding">
                        <div class="mx-auto w-16 h-16 flex items-center justify-center bg-indigo-100 rounded-full mb-2">
                            <i class="bi bi-disc text-indigo-600 text-2xl"></i>
                        </div>
                        <h3 class="font-medium">Lidding Films</h3>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Input Form -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="bi bi-sliders mr-2 text-blue-600"></i>
                        Package Requirements
                    </h2>
                    <form id="recommendationForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium">Product Category</label>
                            <select id="productType" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                <option value="snacks">Snacks & Chips</option>
                                <option value="dairy">Dairy Products</option>
                                <option value="meat">Meat & Seafood</option>
                                <option value="frozen">Frozen Food</option>
                                <option value="coffee">Coffee & Tea</option>
                                <option value="confectionery">Confectionery & Chocolates</option>
                                <option value="bakery">Bakery & Cereal</option>
                                <option value="petfood">Pet Food</option>
                                <option value="pharmaceutical">Pharmaceuticals</option>
                                <option value="cosmetics">Cosmetics & Personal Care</option>
                                <option value="household">Household Products</option>
                                <option value="beverages">Beverages</option>
                                <option value="readymeals">Ready-to-Eat Meals</option>
                                <option value="sauces">Sauces & Condiments</option>
                                <option value="nuts">Nuts & Dry Fruits</option>
                                <option value="supplements">Dietary Supplements</option>
                                <option value="spices">Spices & Seasonings</option>
                                <option value="granola">Granola & Energy Bars</option>
                                <option value="plantbased">Plant-Based Proteins</option>
                                <option value="babyfood">Baby Food</option>
                                <option value="liquor">Spirits & Liquor</option>
                                <option value="candy">Candy & Gummies</option>
                                <option value="jerky">Jerky & Dried Meats</option>
                                <option value="pasta">Pasta & Noodles</option>
                                <option value="seeds">Edible Seeds</option>
                                <option value="herbs">Herbal Products</option>
                                <option value="cannabis">Medical Cannabis Products</option>
                                <option value="energydrinks">Energy Drinks</option>
                                <option value="fertilizers">Garden Fertilizers</option>
                                <option value="proteinpowders">Protein Powders</option>
                                <option value="cleaningproducts">Cleaning Products</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">Shelf Life</label>
                                <select id="shelfLife" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="short">Short (< 3 months)</option>
                                    <option value="medium">Medium (3-6 months)</option>
                                    <option value="long">Long (> 6 months)</option>
                                    <option value="verylong">Very Long (> 12 months)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Barrier Level</label>
                                <select id="barrierLevel" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">Cost Sensitivity</label>
                                <select id="costSensitivity" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="low">Low (Premium)</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High (Economy)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Sustainability</label>
                                <select id="sustainability" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="high">High Priority</option>
                                    <option value="medium">Medium Priority</option>
                                    <option value="low">Low Priority</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">Storage Conditions</label>
                                <select id="storageCondition" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="ambient">Ambient</option>
                                    <option value="refrigerated">Refrigerated</option>
                                    <option value="frozen">Frozen</option>
                                    <option value="hot">Hot Fill</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Print Quality</label>
                                <select id="printQuality" class="w-full p-2 border rounded focus:ring focus:ring-blue-200 focus:border-blue-500">
                                    <option value="high">Premium</option>
                                    <option value="medium">Standard</option>
                                    <option value="low">Basic</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium">Special Requirements</label>
                            <div class="grid grid-cols-2 gap-2 mt-1">
                                <div class="flex items-center">
                                    <input type="checkbox" id="resealable" class="mr-2">
                                    <label for="resealable">Resealable</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="transparent" class="mr-2">
                                    <label for="transparent">Transparency</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="punctureResistant" class="mr-2">
                                    <label for="punctureResistant">Puncture Resistant</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="uvProtection" class="mr-2">
                                    <label for="uvProtection">UV Protection</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="microwavable" class="mr-2">
                                    <label for="microwavable">Microwavable</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="retortable" class="mr-2">
                                    <label for="retortable">Retortable</label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition flex items-center justify-center">
                            <i class="bi bi-search mr-2"></i> Get AI Recommendations
                        </button>
                    </form>
                </div>

                <!-- Results Section -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h2 class="text-xl font-bold mb-4 flex items-center">
                        <i class="bi bi-award mr-2 text-green-600"></i>
                        Recommended Materials
                    </h2>
                    <div id="recommendations" class="space-y-4">
                        <div class="p-8 text-center text-gray-500">
                            <i class="bi bi-arrow-left-circle text-5xl mb-4 text-blue-300"></i>
                            <p>Select your requirements on the left to get personalized material recommendations</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Package Visualization -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="bi bi-box3-fill mr-2 text-purple-600"></i>
                        Package Visualization
                    </h2>
                    <div class="flex">
                        <button id="view3DBtn" class="bg-purple-100 text-purple-700 px-4 py-2 rounded-lg mr-2 hover:bg-purple-200 transition">
                            <i class="bi bi-badge-3d mr-1"></i> 3D View
                        </button>
                        <button id="viewTechBtn" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-lg hover:bg-blue-200 transition">
                            <i class="bi bi-layers mr-1"></i> Technical
                        </button>
                    </div>
                </div>
                <div class="grid md:grid-cols-3 gap-6" id="packagePreview">
                    <div class="p-8 text-center text-gray-500 col-span-3">
                        <i class="bi bi-box2 text-6xl mb-4 text-gray-300"></i>
                        <p>Select a material recommendation to view package visualization</p>
                    </div>
                </div>
            </div>

            <!-- Sustainability Score -->
            <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <i class="bi bi-leaf mr-2 text-green-600"></i>
                    Sustainability Analysis
                </h2>
                <div id="sustainabilityAnalysis">
                    <div class="p-8 text-center text-gray-500">
                        <i class="bi bi-recycle text-6xl mb-4 text-gray-300"></i>
                        <p>Select a material recommendation to view sustainability analysis</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="loading">
        <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto"></div>
            <p class="mt-4 text-lg text-blue-800">Processing your request...</p>
            <p class="text-gray-500 mt-2">Analyzing packaging materials based on your requirements</p>
        </div>
    </div>

    <!-- Material Comparison Modal -->
    <div id="compareModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeCompareModal">&times;</span>
            <h2 class="text-2xl font-bold mb-6">Material Comparison</h2>
            
            <div class="overflow-x-auto">
                <table class="compare-table min-w-full">
                    <thead>
                        <tr>
                            <th class="w-1/5">Properties</th>
                            <th>EVOH/PE Multilayer</th>
                            <th>MetPET/PE</th>
                            <th>PET/LDPE</th>
                            <th>PLA/PBAT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-medium">Barrier Level</td>
                            <td>High</td>
                            <td>High</td>
                            <td>Medium</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td class="font-medium">OTR (cc/m²/24 hr)</td>
                            <td>0.005-0.05</td>
                            <td>0.1-0.5</td>
                            <td>50-100</td>
                            <td>1000-1500</td>
                        </tr>
                        <tr>
                            <td class="font-medium">WVTR (g/m²/24 hr)</td>
                            <td>0.1-0.5</td>
                            <td>0.5-1</td>
                            <td>5-20</td>
                            <td>20-30</td>
                        </tr>
                        <tr>
                            <td class="font-medium">Cost</td>
                            <td>Medium-High</td>
                            <td>Medium-High</td>
                            <td>Low</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td class="font-medium">Sustainability</td>
                            <td class="text-yellow-500">Medium</td>
                            <td class="text-red-500">Low</td>
                            <td class="text-green-500">High</td>
                            <td class="text-green-500">Very High</td>
                        </tr>
                        <tr>
                            <td class="font-medium">Recyclability</td>
                            <td>Difficult</td>
                            <td>Difficult</td>
                            <td>Moderate</td>
                            <td>Compostable</td>
                        </tr>
                        <tr>
                            <td class="font-medium">Best For</td>
                            <td>Meat, Dairy, Coffee</td>
                            <td>Snacks, Coffee, Tea</td>
                            <td>Short shelf-life products</td>
                            <td>Eco-friendly packaging</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-2">Add Materials to Compare:</h3>
                <div class="flex space-x-2">
                    <select id="compareMaterial" class="border p-2 rounded w-full">
                        <option value="">Select a material...</option>
                        <option value="aluminum">Aluminum Foil Laminate</option>
                        <option value="biodegradable">Biodegradable PBAT</option>
                        <option value="paperPE">Paper-PE Laminate</option>
                        <option value="pvdc">PVDC Coated Film</option>
                        <option value="bopa">BOPA/PE Laminate</option>
                        <option value="bopp">BOPP/CPP Structure</option>
                        <option value="petmetpe">PET/MET/PE Structure</option>
                    </select>
                    <button id="addMaterialBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add</button>
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-2">Comparative Analysis:</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 p-4 rounded">
                        <h4 class="font-medium">Barrier Performance</h4>
                        <div class="mt-2 h-4 bg-gray-200 rounded">
                            <div class="h-4 bg-blue-600 rounded" style="width: 80%"></div>
                        </div>
                        <div class="text-sm text-gray-500 mt-1">EVOH/PE & MetPET/PE provide superior barrier</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded">
                        <h4 class="font-medium">Sustainability</h4>
                        <div class="mt-2 h-4 bg-gray-200 rounded">
                            <div class="h-4 bg-green-600 rounded" style="width: 60%"></div>
                        </div>
                        <div class="text-sm text-gray-500 mt-1">PLA/PBAT is most sustainable option</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded">
                        <h4 class="font-medium">Cost Efficiency</h4>
                        <div class="mt-2 h-4 bg-gray-200 rounded">
                            <div class="h-4 bg-yellow-600 rounded" style="width: 65%"></div>
                        </div>
                        <div class="text-sm text-gray-500 mt-1">PET/LDPE offers best value</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded">
                        <h4 class="font-medium">Printability</h4>
                        <div class="mt-2 h-4 bg-gray-200 rounded">
                            <div class="h-4 bg-purple-600 rounded" style="width: 75%"></div>
                        </div>
                        <div class="text-sm text-gray-500 mt-1">MetPET/PE offers best print surface</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sustainability Modal -->
    <div id="sustainabilityModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeSustainabilityModal">&times;</span>
            <h2 class="text-2xl font-bold mb-6 text-green-700">Sustainability Calculator</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Input Parameters</h3>
                    <form id="sustainabilityForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium">Packaging Material</label>
                            <select id="ecoMaterial" class="w-full p-2 border rounded">
                                <option value="petpe">PET/PE Laminate</option>
                                <option value="evohpe">EVOH/PE Multilayer</option>
                                <option value="metpet">MetPET/PE</option>
                                <option value="paperpe">Paper/PE Laminate</option>
                                <option value="bioplastic">PLA/PBAT Bioplastic</option>
                                <option value="bopape">BOPA/PE Laminate</option>
                                <option value="boppmet">BOPP/MET/PE Structure</option>
                                <option value="aluminum">Aluminum/PE Laminate</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium">Annual Production (tons)</label>
                            <input type="number" id="annualProduction" class="w-full p-2 border rounded" value="100">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium">Transportation Distance (km)</label>
                            <input type="number" id="transportDistance" class="w-full p-2 border rounded" value="500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium">End-of-Life Scenario</label>
                            <select id="endOfLife" class="w-full p-2 border rounded">
                                <option value="recycle">Recycling</option>
                                <option value="landfill">Landfill</option>
                                <option value="incineration">Incineration</option>
                                <option value="compost">Composting</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                            Calculate Environmental Impact
                        </button>
                    </form>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Environmental Impact Results</h3>
                    <div id="ecoResults" class="bg-gray-50 p-4 rounded">
                        <div id="carbonFootprint" class="mb-6">
                            <h4 class="font-medium mb-2">Carbon Footprint</h4>
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl font-bold">245</span>
                                <span class="text-gray-600">tons CO2 eq./year</span>
                                <span class="text-red-500 text-sm">+15% vs. industry avg.</span>
                            </div>
                            <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-red-500 rounded-full" style="width: 65%"></div>
                            </div>
                        </div>
                        
                        <div id="waterUsage" class="mb-6">
                            <h4 class="font-medium mb-2">Water Usage</h4>
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl font-bold">1,250</span>
                                <span class="text-gray-600">kL/year</span>
                                <span class="text-green-500 text-sm">-8% vs. industry avg.</span>
                            </div>
                            <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-blue-500 rounded-full" style="width: 45%"></div>
                            </div>
                        </div>
                        
                        <div id="wasteGeneration" class="mb-6">
                            <h4 class="font-medium mb-2">Waste Generation</h4>
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl font-bold">85</span>
                                <span class="text-gray-600">tons/year</span>
                                <span class="text-yellow-500 text-sm">+2% vs. industry avg.</span>
                            </div>
                            <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-yellow-500 rounded-full" style="width: 52%"></div>
                            </div>
                        </div>
                        
                        <div id="recyclingRate" class="mb-2">
                            <h4 class="font-medium mb-2">Recyclability</h4>
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl font-bold">35%</span>
                                <span class="text-gray-600">recovery rate</span>
                                <span class="text-red-500 text-sm">-25% vs. industry avg.</span>
                            </div>
                            <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-green-500 rounded-full" style="width: 35%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-3">Recommended Improvements</h3>
                <div class="bg-green-50 p-4 rounded border border-green-200">
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="bi bi-check-circle-fill text-green-600 mr-2 text-lg"></i>
                            <span>Consider switching to Paper/PE Laminate for 38% carbon footprint reduction</span>
                        </li>
                        <li class="flex items-start">
                            <i class="bi bi-check-circle-fill text-green-600 mr-2 text-lg"></i>
                            <span>Optimize material thickness to reduce waste by up to 15%</span>
                        </li>
                        <li class="flex items-start">
                            <i class="bi bi-check-circle-fill text-green-600 mr-2 text-lg"></i>
                            <span>Partner with local recycling programs to improve recovery rates</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Gemini AI Assistant Modal -->
    <div id="geminiModal" class="gemini-modal" x-show="showGeminiModal">
        <div class="modal-content w-11/12 max-w-4xl">
            <span class="close-modal" @click="closeGeminiModal()">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-blue-700">AI Packaging Assistant</h2>
            
            <div class="gemini-chat-container bg-white p-4 mb-4" id="geminiChatContainer">
                <template x-for="(message, index) in geminiMessages" :key="index">
                    <div :class="`gemini-message ${message.role === 'user' ? 'gemini-user' : 'gemini-assistant'}`">
                        <p x-text="message.content"></p>
                    </div>
                </template>
                <div x-show="isLoading" class="gemini-message gemini-assistant">
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
            
            <div class="flex mt-4">
                <textarea 
                    id="geminiInput" 
                    x-model="geminiInput" 
                    class="flex-1 p-3 border rounded-l-lg focus:outline-none focus:ring focus:border-blue-300" 
                    placeholder="Ask about packaging materials, recommendations, or technical specifications..."
                    rows="2"></textarea>
                <button 
                    @click="sendToGemini()" 
                    :disabled="isLoading || geminiInput.trim() === ''" 
                    :class="(isLoading || geminiInput.trim() === '') ? 'bg-blue-300' : 'bg-blue-600 hover:bg-blue-700'" 
                    class="px-4 py-2 text-white rounded-r-lg transition">
                    <i class="bi bi-send"></i>
                </button>
            </div>
            
            <div class="mt-4 text-sm text-gray-500">
                <p>Suggested queries:</p>
                <div class="flex flex-wrap gap-2 mt-1">
                    <button @click="suggestedQuery('What is the best packaging material for coffee?')" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700">Coffee packaging</button>
                    <button @click="suggestedQuery('Compare EVOH, PET, and BOPP for food packaging')" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700">Compare materials</button>
                    <button @click="suggestedQuery('What makes a packaging material sustainable?')" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700">Sustainability factors</button>
                    <button @click="suggestedQuery('Explain 3-layer vs 4-layer laminate structures')" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-gray-700">Laminate structures</button>
                </div>

                <div id="aiRecommendationResults" class="mt-6 overflow-x-auto hidden">
                    <h3 class="font-medium mb-2 text-blue-700">AI Material Recommendations</h3>
                    <table class="min-w-full border divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Material</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Sustainability</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Durability</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Cost</th>
                                <th class="px-4 py-2 text-left text-sm font-medium text-gray-700">Best For</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="aiMaterialsTableBody">
                            <!-- Populated dynamically by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pouch Generator Modal -->
    <div id="pouchGeneratorModal" class="modal" x-show="showPouchGeneratorModal">
        <div class="modal-content w-11/12 max-w-4xl">
            <span class="close-modal" @click="closePouchGeneratorModal()">&times;</span>
            <h2 class="text-2xl font-bold mb-4 text-pink-700">3D Pouch Generator</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Pouch Specifications</h3>
                    <form id="pouchGeneratorForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium">Pouch Type</label>
                            <select id="pouchType" class="w-full p-2 border rounded" x-model="pouchType">
                                <option value="standup">Stand-Up Pouch</option>
                                <option value="pillow">Pillow Pouch</option>
                                <option value="doypack">Doypack</option>
                                <option value="sidegusset">Side Gusset</option>
                                <option value="spout">Spout Pouch</option>
                                <option value="zipper">Zipper Lock Pouch</option>
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">Width (mm)</label>
                                <input type="number" id="pouchWidth" class="w-full p-2 border rounded" value="150" x-model="pouchWidth">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Height (mm)</label>
                                <input type="number" id="pouchHeight" class="w-full p-2 border rounded" value="200" x-model="pouchHeight">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium">Gusset/Depth (mm)</label>
                                <input type="number" id="pouchDepth" class="w-full p-2 border rounded" value="80" x-model="pouchDepth">
                            </div>
                            <div>
                                <label class="block text-sm font-medium">Material</label>
                                <select id="pouchMaterial" class="w-full p-2 border rounded" x-model="pouchMaterial">
                                    <option value="pet-pe">PET/PE</option>
                                    <option value="metpet-pe">MetPET/PE</option>
                                    <option value="paper-pe">Paper/PE</option>
                                    <option value="al-pe">Aluminum/PE</option>
                                    <option value="bopa-pe">BOPA/PE</option>
                                    <option value="pla-pbat">PLA/PBAT</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium">Special Features</label>
                            <div class="grid grid-cols-2 gap-2 mt-1">
                                <div class="flex items-center">
                                    <input type="checkbox" id="zipperFeature" class="mr-2" x-model="zipperFeature">
                                    <label for="zipperFeature">Zipper</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="tearNotchFeature" class="mr-2" x-model="tearNotchFeature">
                                    <label for="tearNotchFeature">Tear Notch</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="euroSlotFeature" class="mr-2" x-model="euroSlotFeature">
                                    <label for="euroSlotFeature">Euro Slot</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="valveFeature" class="mr-2" x-model="valveFeature">
                                    <label for="valveFeature">Degassing Valve</label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="w-full bg-pink-600 text-white py-2 rounded hover:bg-pink-700" @click="generatePouch()">
                            Generate 3D Pouch
                        </button>
                    </form>
                </div>
                
                <div class="pouch-preview-container">
                    <h3 class="text-lg font-semibold mb-4">Preview</h3>
                    <div id="pouchPreview" class="relative">
                        <div class="flex items-center justify-center h-80 bg-gray-100 rounded-lg p-4">
                            <div class="pouch-preview bg-white shadow-lg rounded-lg h-64 w-40 relative" 
                                :style="`height: ${pouchHeight * 0.3}px; width: ${pouchWidth * 0.3}px;`">
                                
                                <!-- Front face with material texture -->
                                <div class="absolute inset-0 rounded-lg" 
                                    :class="{
                                        'bg-gradient-to-b from-blue-100 to-blue-200': pouchMaterial === 'pet-pe',
                                        'bg-gradient-to-b from-gray-200 to-gray-300': pouchMaterial === 'metpet-pe',
                                        'bg-gradient-to-b from-yellow-50 to-yellow-100': pouchMaterial === 'paper-pe',
                                        'bg-gradient-to-b from-gray-300 to-gray-400': pouchMaterial === 'al-pe',
                                        'bg-gradient-to-b from-purple-100 to-purple-200': pouchMaterial === 'bopa-pe',
                                        'bg-gradient-to-b from-green-100 to-green-200': pouchMaterial === 'pla-pbat'
                                    }">
                                </div>
                                
                                <!-- Gusset shadow (for stand-up pouches) -->
                                <div x-show="pouchType === 'standup' || pouchType === 'doypack' || pouchType === 'spout'"
                                    class="absolute bottom-0 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-10 rounded-b-lg"
                                    :style="`height: 20px; width: ${pouchDepth * 0.3}px;`">
                                </div>
                                
                                <!-- Zipper if selected -->
                                <div x-show="zipperFeature" 
                                    class="absolute top-10 left-0 right-0 h-2 bg-white bg-opacity-30 border-b border-t border-gray-300">
                                </div>
                                
                                <!-- Tear notch if selected -->
                                <div x-show="tearNotchFeature"
                                    class="absolute top-3 right-3 w-2 h-4 border-r border-t border-b border-gray-400 border-dashed rounded-r">
                                </div>
                                
                                <!-- Euro slot if selected -->
                                <div x-show="euroSlotFeature"
                                    class="absolute top-2 left-1/2 transform -translate-x-1/2 w-4 h-8 bg-transparent border border-gray-400 rounded-full">
                                </div>
                                
                                <!-- Valve if selected -->
                                <div x-show="valveFeature"
                                    class="absolute bottom-10 right-10 w-4 h-4 bg-white rounded-full border border-gray-400">
                                    <div class="absolute inset-1 bg-gray-200 rounded-full"></div>
                                </div>
                                
                                <!-- Dimension lines and labels -->
                                <div class="absolute -left-16 top-1/2 transform -translate-y-1/2 text-xs font-semibold">
                                    <div class="dimension-line h-px w-12 bg-black"></div>
                                    <div class="dimension-label -ml-2 -mt-5" x-text="`H: ${pouchHeight} mm`"></div>
                                </div>
                                <div class="absolute left-1/2 -bottom-12 transform -translate-x-1/2 text-xs font-semibold">
                                    <div class="dimension-line h-8 w-px bg-black"></div>
                                    <div class="dimension-label -ml-12 mt-1" x-text="`W: ${pouchWidth} mm`"></div>
                                </div>
                                <div class="absolute -right-16 top-1/2 transform -translate-y-1/2 text-xs font-semibold" 
                                    x-show="pouchType === 'standup' || pouchType === 'doypack' || pouchType === 'sidegusset'">
                                    <div class="dimension-line h-px w-12 bg-black"></div>
                                    <div class="dimension-label -mr-2 -mt-5" x-text="`D: ${pouchDepth} mm`"></div>
                                </div>
                                
                                <!-- Volume indicator -->
                                <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-semibold">
                                    <span x-text="`Vol: ~${calculateVolume()} ml`"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">Technical Specifications</h4>
                        <ul class="text-sm space-y-1">
                            <li class="flex justify-between">
                                <span>Dimensions:</span>
                                <span x-text="`${pouchWidth} × ${pouchHeight} × ${pouchDepth} mm`"></span>
                            </li>
                            <li class="flex justify-between">
                                <span>Material:</span>
                                <span x-text="formatMaterial(pouchMaterial)"></span>
                            </li>
                            <li class="flex justify-between">
                                <span>Approx. Volume:</span>
                                <span x-text="`${calculateVolume()} ml`"></span>
                            </li>
                            <li class="flex justify-between">
                                <span>Features:</span>
                                <span x-text="formatFeatures()"></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
        function app() {
            return {
                // Gemini integration
                GEMINI_API_KEY: "AIzaSyAFBraIPt09nzRd6XhXPUOkoLCmgWBgTYo",
                geminiMessages: [],
                geminiInput: "",
                isLoading: false,
                showGeminiModal: false,
                
                // Pouch Generator Properties
                showPouchGeneratorModal: false,
                pouchType: "standup",
                pouchWidth: 150,
                pouchHeight: 200,
                pouchDepth: 80,
                pouchMaterial: "pet-pe",
                zipperFeature: false,
                tearNotchFeature: false,
                euroSlotFeature: false,
                valveFeature: false,
                
                async init() {
                    // Initialize with a welcome message
                    this.geminiMessages.push({
                        role: "assistant",
                        content: "Hello! I'm your AI Packaging Assistant. How can I help you today with packaging materials, recommendations, or technical specifications?"
                    });
                },
                
                openGeminiModal() {
                    this.showGeminiModal = true;
                    document.getElementById('geminiModal').style.display = 'flex';
                    setTimeout(() => {
                        const chatContainer = document.getElementById('geminiChatContainer');
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 100);
                },
                
                closeGeminiModal() {
                    this.showGeminiModal = false;
                    document.getElementById('geminiModal').style.display = 'none';
                },
                
                suggestedQuery(query) {
                    this.geminiInput = query;
                    this.sendToGemini();
                },

                openPouchGeneratorModal() {
                    this.showPouchGeneratorModal = true;
                    document.getElementById('pouchGeneratorModal').style.display = 'flex';
                },
                
                closePouchGeneratorModal() {
                    this.showPouchGeneratorModal = false;
                    document.getElementById('pouchGeneratorModal').style.display = 'none';
                },
                
                generatePouch() {
                    // Already reactive with Alpine.js
                    console.log("Pouch generated with specifications:", {
                        type: this.pouchType,
                        width: this.pouchWidth,
                        height: this.pouchHeight,
                        depth: this.pouchDepth,
                        material: this.pouchMaterial,
                        features: {
                            zipper: this.zipperFeature,
                            tearNotch: this.tearNotchFeature,
                            euroSlot: this.euroSlotFeature,
                            valve: this.valveFeature
                        }
                    });
                },
                
                calculateVolume() {
                    // Very basic volume calculation (simplified)
                    let volume = 0;
                    
                    if (this.pouchType === 'pillow') {
                        // Pillow pouch has roughly half the volume of its rectangular dimensions
                        volume = this.pouchWidth * this.pouchHeight * 20 / 1000 * 0.5;
                    } else if (this.pouchType === 'standup' || this.pouchType === 'doypack' || this.pouchType === 'spout') {
                        // Stand-up pouches have more volume due to gusset
                        volume = this.pouchWidth * this.pouchHeight * this.pouchDepth / 1000 * 0.7;
                    } else {
                        // Side gusset and others
                        volume = this.pouchWidth * this.pouchHeight * this.pouchDepth / 1000 * 0.6;
                    }
                    
                    return Math.round(volume);
                },
                
                formatMaterial(material) {
                    const materialMap = {
                        'pet-pe': 'PET/PE Laminate',
                        'metpet-pe': 'Metallized PET/PE',
                        'paper-pe': 'Paper/PE Laminate',
                        'al-pe': 'Aluminum/PE Laminate',
                        'bopa-pe': 'BOPA/PE Laminate',
                        'pla-pbat': 'PLA/PBAT Biodegradable'
                    };
                    
                    return materialMap[material] || material;
                },
                
                formatFeatures() {
                    const features = [];
                    
                    if (this.zipperFeature) features.push('Zipper');
                    if (this.tearNotchFeature) features.push('Tear Notch');
                    if (this.euroSlotFeature) features.push('Euro Slot');
                    if (this.valveFeature) features.push('Degassing Valve');
                    
                    return features.length ? features.join(', ') : 'None';
                },
                
                async sendToGemini() {
                    if (this.geminiInput.trim() === "" || this.isLoading) return;
                    
                    const userMessage = this.geminiInput.trim();
                    this.geminiMessages.push({
                        role: "user",
                        content: userMessage
                    });
                    
                    this.geminiInput = "";
                    this.isLoading = true;
                    
                    setTimeout(() => {
                        const chatContainer = document.getElementById('geminiChatContainer');
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 100);
                    
                    try {
                        // Hide any previous table results
                        document.getElementById('aiRecommendationResults').classList.add('hidden');
                        
                        // Prepare the context for the AI
                        const contextPrompt = `You are an expert packaging consultant specializing in flexible packaging materials, especially pouches, laminates, and films. Your expertise includes:
                        
                        1. Material properties (barrier, strength, sustainability)
                        2. Industry-specific packaging requirements
                        3. Technical aspects of packaging structures
                        4. Cost-effectiveness analysis
                        5. Sustainability considerations
                        
                        Only answer questions related to packaging materials, flexible packaging, pouches, laminates, films, barrier properties, sustainability of packaging, and related topics. Be specific, technical, and helpful.

                        Respond to this query: ${userMessage}`;
                        
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${this.GEMINI_API_KEY}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: contextPrompt
                                    }]
                                }],
                                safetySettings: [
                                    {
                                        category: "HARM_CATEGORY_HATE_SPEECH",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_HARASSMENT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    }
                                ],
                                generationConfig: {
                                    temperature: 0.7,
                                    maxOutputTokens: 800
                                }
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error('Failed to get response from Gemini API');
                        }
                        
                        const data = await response.json();
                        let aiResponse = "";
                        
                        if (data.candidates && data.candidates.length > 0 && 
                            data.candidates[0].content && 
                            data.candidates[0].content.parts && 
                            data.candidates[0].content.parts.length > 0) {
                            aiResponse = data.candidates[0].content.parts[0].text;
                        } else {
                            aiResponse = "I'm sorry, I couldn't generate a response. Please try again with a different question.";
                        }
                        
                        this.geminiMessages.push({
                            role: "assistant",
                            content: aiResponse
                        });
                        
                        // Check if we need to display structured material recommendations
                        if (userMessage.toLowerCase().includes('recommend') || 
                            userMessage.toLowerCase().includes('suggest') || 
                            userMessage.toLowerCase().includes('best material') ||
                            userMessage.toLowerCase().includes('compare material')) {
                            
                            this.showRecommendationsTable(aiResponse);
                        }
                        
                    } catch (error) {
                        console.error("Error calling Gemini API:", error);
                        this.geminiMessages.push({
                            role: "assistant",
                            content: "I'm sorry, I encountered an error processing your request. Please try again later."
                        });
                    } finally {
                        this.isLoading = false;
                        setTimeout(() => {
                            const chatContainer = document.getElementById('geminiChatContainer');
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        }, 100);
                    }
                },
                
                showRecommendationsTable(aiResponse) {
                    try {
                        // Extract material names, properties from the response
                        const materials = [];
                        
                        // Simple regex pattern matching to identify material recommendations
                        const materialMatches = aiResponse.match(/([A-Za-z0-9\/\-]+(?:\s*\/\s*[A-Za-z0-9\-]+)*)\s*:\s*([^\.]+)/g) || [];
                        
                        for (const match of materialMatches) {
                            const [name, description] = match.split(':').map(s => s.trim());
                            
                            // Skip if not actually a material name
                            if (name.length > 30 || 
                                name.toLowerCase().includes('note') || 
                                name.toLowerCase().includes('conclusion') ||
                                name.toLowerCase().includes('summary')) {
                                continue;
                            }
                            
                            const material = {
                                name: name,
                                description: description,
                                sustainability: this.extractProperty(description, ['sustainability', 'eco-friendly', 'environmental']),
                                durability: this.extractProperty(description, ['durability', 'strength', 'barrier']),
                                cost: this.extractProperty(description, ['cost', 'price', 'economical']),
                                bestFor: this.extractProperty(description, ['best for', 'ideal for', 'suitable for'])
                            };
                            
                            materials.push(material);
                        }
                        
                        if (materials.length > 0) {
                            const tableBody = document.getElementById('aiMaterialsTableBody');
                            tableBody.innerHTML = '';
                            
                            materials.forEach(material => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td class="px-4 py-2">${material.name}</td>
                                    <td class="px-4 py-2">${material.sustainability || 'N/A'}</td>
                                    <td class="px-4 py-2">${material.durability || 'N/A'}</td>
                                    <td class="px-4 py-2">${material.cost || 'N/A'}</td>
                                    <td class="px-4 py-2">${material.bestFor || 'N/A'}</td>
                                `;
                                tableBody.appendChild(row);
                            });
                            
                            document.getElementById('aiRecommendationResults').classList.remove('hidden');
                        }
                    } catch (error) {
                        console.error("Error generating recommendations table:", error);
                    }
                },
                
                extractProperty(text, keywords) {
                    for (const keyword of keywords) {
                        const regex = new RegExp(`${keyword}[^,\.;]+`, 'i');
                        const match = text.match(regex);
                        if (match) {
                            return match[0].replace(new RegExp(`^${keyword}`, 'i'), '').trim();
                        }
                    }
                    return '';
                }
            };
        }
        
        // Initialize variables to store comparison materials
        let selectedMaterials = [];
        let activeMaterialIndex = 0;
        let materialDatabase = [];

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load packaging material data from spreadsheet
            loadPackagingData();
            
            // Form submission
            document.getElementById('recommendationForm').addEventListener('submit', handleFormSubmit);
            
            // Comparison button
            document.getElementById('compareBtn').addEventListener('click', () => {
                document.getElementById('compareModal').style.display = 'flex';
            });
            
            // Close comparison modal
            document.getElementById('closeCompareModal').addEventListener('click', () => {
                document.getElementById('compareModal').style.display = 'none';
            });
            
            // Sustainability button
            document.getElementById('sustainabilityBtn').addEventListener('click', () => {
                document.getElementById('sustainabilityModal').style.display = 'flex';
            });
            
            // Close sustainability modal
            document.getElementById('closeSustainabilityModal').addEventListener('click', () => {
                document.getElementById('sustainabilityModal').style.display = 'none';
            });
            
            // New analysis button
            document.getElementById('newAnalysis').addEventListener('click', resetForm);
            
            // Packaging type selection
            document.querySelectorAll('.packaging-type-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.packaging-type-card').forEach(c => {
                        c.classList.remove('border-blue-500', 'border-2');
                    });
                    this.classList.add('border-blue-500', 'border-2');
                });
            });

            // Sustainability form
            document.getElementById('sustainabilityForm').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateSustainability();
            });
            
            // 3D view button
            document.getElementById('view3DBtn').addEventListener('click', function() {
                if (document.getElementById('recommendations').children.length > 1) {
                    show3DView();
                }
            });
            
            // Technical view button
            document.getElementById('viewTechBtn').addEventListener('click', function() {
                if (document.getElementById('recommendations').children.length > 1) {
                    showTechnicalView();
                }
            });

            // Add material to comparison
            document.getElementById('addMaterialBtn').addEventListener('click', function() {
                const material = document.getElementById('compareMaterial').value;
                if (material) {
                    // Logic to add material to comparison would go here
                    alert(`Material '${material}' added to comparison`);
                }
            });
            
            // Monitor Enter key press in Gemini input
            document.getElementById('geminiInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    document.querySelector('[x-data="app()"]').__x.$data.sendToGemini();
                }
            });
        });

        async function loadPackagingData() {
            try {
                // Using the provided spreadsheet URL (note: using a JSON endpoint would be better for production)
                const response = await fetch('https://db.zetaverse.one/storage/v1/object/public/app-uploads/spreadsheet-1743248344724/9qVU9vgW1AdSZJL4WNZ2fzKtFC72/p83u4pel.xlsx');
                
                if (!response.ok) {
                    throw new Error('Failed to load packaging material data');
                }
                
                // Since we're receiving an Excel file, which can't be directly parsed by Papa Parse
                // In a real application, you would:
                // 1. Use a server-side component to convert Excel to CSV, or
                // 2. Provide a CSV endpoint directly, or
                // 3. Use a library like SheetJS to parse Excel files in the browser
                
                // For now, we'll use a fallback sample dataset
                materialDatabase = [
                    {
                        name: "PET/PE Laminate",
                        barrier: "Medium",
                        cost: "Medium",
                        sustainability: "Medium",
                        otr: "50-100",
                        wvtr: "5-20",
                        density: "1.35",
                        thickness: "70-90",
                        printQuality: "Good",
                        recyclability: "Moderate",
                        bestFor: "General purpose, beverages, sauces"
                    },
                    {
                        name: "MetPET/PE",
                        barrier: "High",
                        cost: "Medium-High",
                        sustainability: "Low",
                        otr: "0.1-0.5",
                        wvtr: "0.5-1",
                        density: "1.4",
                        thickness: "90-120",
                        printQuality: "Excellent",
                        recyclability: "Limited",
                        bestFor: "Coffee, snacks, chips, nuts"
                    },
                    {
                        name: "EVOH/PE Multilayer",
                        barrier: "Very High",
                        cost: "High",
                        sustainability: "Medium",
                        otr: "0.005-0.05",
                        wvtr: "0.1-0.5",
                        density: "1.05",
                        thickness: "90-130",
                        printQuality: "Good",
                        recyclability: "Difficult",
                        bestFor: "Meat, dairy, medical products"
                    },
                    {
                        name: "PLA/PBAT Biodegradable",
                        barrier: "Low",
                        cost: "Medium-High",
                        sustainability: "Very High",
                        otr: "1000-1500",
                        wvtr: "20-30",
                        density: "1.25",
                        thickness: "80-100",
                        printQuality: "Moderate",
                        recyclability: "Compostable",
                        bestFor: "Eco-friendly packaging, dry goods"
                    },
                    {
                        name: "Paper/PE Laminate",
                        barrier: "Medium",
                        cost: "Medium",
                        sustainability: "High",
                        otr: "50-200",
                        wvtr: "10-20",
                        density: "0.9",
                        thickness: "100-120",
                        printQuality: "Good",
                        recyclability: "Good",
                        bestFor: "Sustainable packaging, coffee, sugar"
                    },
                    {
                        name: "Aluminum/PE Laminate",
                        barrier: "Very High",
                        cost: "High",
                        sustainability: "Low",
                        otr: "<0.01",
                        wvtr: "<0.01",
                        density: "1.5",
                        thickness: "100-120",
                        printQuality: "Excellent",
                        recyclability: "Difficult",
                        bestFor: "Coffee, pharmaceuticals, long shelf life"
                    },
                    {
                        name: "BOPP/CPP Structure",
                        barrier: "Low-Medium",
                        cost: "Low",
                        sustainability: "Medium",
                        otr: "1000-2000",
                        wvtr: "5-10",
                        density: "0.9",
                        thickness: "50-70",
                        printQuality: "Good",
                        recyclability: "Moderate",
                        bestFor: "Snacks, bakery, general packaging"
                    },
                    {
                        name: "BOPA/PE Laminate",
                        barrier: "Medium-High",
                        cost: "Medium",
                        sustainability: "Medium",
                        otr: "10-50",
                        wvtr: "10-20",
                        density: "1.13",
                        thickness: "80-100",
                        printQuality: "Good",
                        recyclability: "Moderate",
                        bestFor: "Frozen foods, retort, high puncture resistance"
                    }
                ];
                
                console.log("Loaded material database:", materialDatabase);
                
            } catch (error) {
                console.error("Error loading packaging data:", error);
                // Fallback data is already defined above
            }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Show loading indicator
            document.getElementById('loading').style.display = 'flex';
            
            // Gather form data
            const formData = {
                productType: document.getElementById('productType').value,
                shelfLife: document.getElementById('shelfLife').value,
                barrierLevel: document.getElementById('barrierLevel').value,
                costSensitivity: document.getElementById('costSensitivity').value,
                sustainability: document.getElementById('sustainability').value,
                storageCondition: document.getElementById('storageCondition').value,
                printQuality: document.getElementById('printQuality').value,
                resealable: document.getElementById('resealable').checked,
                transparent: document.getElementById('transparent').checked,
                punctureResistant: document.getElementById('punctureResistant').checked,
                uvProtection: document.getElementById('uvProtection').checked,
                microwavable: document.getElementById('microwavable')?.checked || false,
                retortable: document.getElementById('retortable')?.checked || false
            };

            try {
                // Use Gemini API for smart recommendations
                const recommendations = await fetchAIRecommendations(formData);
                displayRecommendations(recommendations);
                
                // Display package preview for first recommendation
                if (recommendations.length > 0) {
                    displayPackagePreview(recommendations[0]);
                    displaySustainabilityAnalysis(recommendations[0]);
                }
            } catch (error) {
                console.error("Error fetching recommendations:", error);
                // Generate and display local fallback recommendations
                const recommendations = generateRecommendations(formData);
                displayRecommendations(recommendations);
                
                if (recommendations.length > 0) {
                    displayPackagePreview(recommendations[0]);
                    displaySustainabilityAnalysis(recommendations[0]);
                }
            } finally {
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function fetchAIRecommendations(formData) {
            try {
                const GEMINI_API_KEY = "AIzaSyAFBraIPt09nzRd6XhXPUOkoLCmgWBgTYo";
                
                // Prepare form data to be sent to Gemini API for real-time analysis
                const contextPrompt = `Act as an AI packaging expert. Provide structured packaging recommendations based on these requirements:
                
                - Product Type: ${formData.productType}
                - Shelf Life: ${formData.shelfLife}
                - Barrier Level: ${formData.barrierLevel}
                - Cost Sensitivity: ${formData.costSensitivity}
                - Sustainability Priority: ${formData.sustainability}
                - Storage Condition: ${formData.storageCondition}
                - Print Quality: ${formData.printQuality}
                - Special Requirements: ${
                    [
                        formData.resealable ? 'Resealable' : '',
                        formData.transparent ? 'Transparency' : '',
                        formData.punctureResistant ? 'Puncture Resistant' : '',
                        formData.uvProtection ? 'UV Protection' : '', 
                        formData.microwavable ? 'Microwavable' : '',
                        formData.retortable ? 'Retortable' : ''
                    ].filter(Boolean).join(', ') || 'None'
                }
                
                Provide 3-5 precise packaging material recommendations with this exact format and properties for each:
                {
                  "name": "Material name",
                  "barrier": "High/Medium/Low",
                  "cost": "High/Medium/Low",
                  "sustainability": "High/Medium/Low",
                  "properties": {
                    "otr": "Oxygen transmission rate range",
                    "wvtr": "Water vapor transmission rate range",
                    "density": "Density value",
                    "thickness": "Thickness range in µm",
                    "printQuality": "Excellent/Good/Fair",
                    "recyclability": "Good/Moderate/Limited"
                  },
                  "structure": [
                    {"name": "Layer1", "color": "bg-blue-600", "thickness": "12µm"},
                    {"name": "Layer2", "color": "bg-yellow-400", "thickness": "2µm"}
                  ],
                  "sustainabilityScore": 75,
                  "recyclabilityScore": 70,
                  "carbonFootprint": "Low/Medium/High",
                  "bestFor": "Best applications"
                }

                Return your recommendations as an array of these structured objects. Only provide the structured data array, no explanations.`;

                // Show loading for at least 1.5 seconds to make the process feel more significant
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: contextPrompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.4,
                                maxOutputTokens: 1024
                            }
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to get response from Gemini API');
                    }
                    
                    const data = await response.json();
                    let aiResponse = "";
                    
                    if (data.candidates && data.candidates.length > 0 && 
                        data.candidates[0].content && 
                        data.candidates[0].content.parts && 
                        data.candidates[0].content.parts.length > 0) {
                        aiResponse = data.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error("Invalid Gemini API response");
                    }
                    
                    // Try to extract JSON from the response
                    try {
                        // Find JSON array in the response
                        const jsonMatch = aiResponse.match(/\[\s*\{[\s\S]*\}\s*\]/);
                        
                        if (jsonMatch) {
                            const recommendations = JSON.parse(jsonMatch[0]);
                            if (Array.isArray(recommendations) && recommendations.length > 0) {
                                return recommendations;
                            }
                        }
                        
                        throw new Error("Could not parse recommendations from API response");
                    } catch (parseError) {
                        console.error("Error parsing Gemini response:", parseError);
                        throw parseError;
                    }
                } catch (apiError) {
                    console.error("Gemini API error:", apiError);
                    // Fall back to locally generated recommendations
                    return generateRecommendations(formData);
                }
                
            } catch (error) {
                console.error("Error in fetchAIRecommendations:", error);
                // Return locally generated recommendations as fallback
                return generateRecommendations(formData);
            }
        }

        function generateRecommendations(formData) {
            // This is a sample implementation - in a real system this would query a database
            // or use an ML model to generate personalized recommendations
            
            // Generate different recommendations based on the form inputs
            let recommendations = [];
            
            // Determine recommendations based on product type and other factors
            if ((formData.productType === 'snacks' || formData.productType === 'coffee') && formData.barrierLevel === 'high') {
                recommendations.push({
                    name: 'MetPET/PE Laminate',
                    barrier: 'High',
                    cost: 'Medium-High',
                    sustainability: 'Low',
                    properties: {
                        otr: '0.1-0.5',
                        wvtr: '0.5-1',
                        density: '1.4',
                        thickness: '90-120',
                        printQuality: 'Excellent',
                        recyclability: 'Limited'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Metallization', color: 'bg-gray-400', thickness: '<1µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '50µm' }
                    ],
                    sustainabilityScore: 35,
                    recyclabilityScore: 30,
                    carbonFootprint: 'High',
                    bestFor: 'High-barrier, long shelf-life snacks and coffee'
                });
            }
            
            if (formData.productType === 'coffee' && formData.shelfLife === 'verylong') {
                recommendations.push({
                    name: 'PET/AL/PE Structure',
                    barrier: 'Very High',
                    cost: 'High',
                    sustainability: 'Low',
                    properties: {
                        otr: '<0.01',
                        wvtr: '<0.01',
                        density: '1.5',
                        thickness: '100-120',
                        printQuality: 'Excellent',
                        recyclability: 'Difficult'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'Aluminum', color: 'bg-gray-500', thickness: '7µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '50µm' }
                    ],
                    sustainabilityScore: 25,
                    recyclabilityScore: 20,
                    carbonFootprint: 'Very High',
                    bestFor: 'Maximum barrier for coffee beans and ground coffee'
                });
            }
            
            if ((formData.sustainability === 'high' || formData.sustainability === 'medium') && 
                (formData.barrierLevel === 'low' || formData.barrierLevel === 'medium')) {
                recommendations.push({
                    name: 'Paper/PE Laminate',
                    barrier: 'Medium',
                    cost: 'Medium',
                    sustainability: 'High',
                    properties: {
                        otr: '50-200',
                        wvtr: '10-20',
                        density: '0.9',
                        thickness: '100-120',
                        printQuality: 'Good',
                        recyclability: 'Good'
                    },
                    structure: [
                        { name: 'Paper', color: 'bg-yellow-100', thickness: '60µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '40µm' }
                    ],
                    sustainabilityScore: 75,
                    recyclabilityScore: 70,
                    carbonFootprint: 'Low',
                    bestFor: 'Sustainable packaging for dry snacks and coffee'
                });
            }
            
            if ((formData.barrierLevel === 'high' && formData.shelfLife === 'long') || 
                (formData.productType === 'meat' || formData.productType === 'dairy')) {
                recommendations.push({
                    name: 'EVOH/PE Multilayer',
                    barrier: 'Very High',
                    cost: 'High',
                    sustainability: 'Medium',
                    properties: {
                        otr: '0.005-0.05',
                        wvtr: '0.1-0.5',
                        density: '1.05',
                        thickness: '100-140',
                        printQuality: 'Good',
                        recyclability: 'Moderate'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'EVOH', color: 'bg-red-500', thickness: '10µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '76µm' }
                    ],
                    sustainabilityScore: 55,
                    recyclabilityScore: 40,
                    carbonFootprint: 'Medium',
                    bestFor: 'Very high barrier applications, meat, dairy, medical'
                });
            }
            
            if (formData.productType === 'frozen' || formData.storageCondition === 'frozen') {
                recommendations.push({
                    name: 'BOPA/PE Laminate',
                    barrier: 'Medium-High',
                    cost: 'Medium',
                    sustainability: 'Medium',
                    properties: {
                        otr: '10-50',
                        wvtr: '10-20',
                        density: '1.13',
                        thickness: '80-100',
                        printQuality: 'Good',
                        recyclability: 'Moderate'
                    },
                    structure: [
                        { name: 'BOPA (Nylon)', color: 'bg-purple-600', thickness: '15µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '60µm' }
                    ],
                    sustainabilityScore: 50,
                    recyclabilityScore: 45,
                    carbonFootprint: 'Medium',
                    bestFor: 'Frozen foods, products requiring puncture resistance'
                });
            }
            
            // Add more options based on cost and barrier needs
            if (formData.costSensitivity === 'high' && formData.barrierLevel !== 'high') {
                recommendations.push({
                    name: 'PET/LDPE Structure',
                    barrier: 'Medium',
                    cost: 'Low',
                    sustainability: 'Medium',
                    properties: {
                        otr: '50-100',
                        wvtr: '5-20',
                        density: '1.35',
                        thickness: '70-90',
                        printQuality: 'Good',
                        recyclability: 'Good'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'LDPE', color: 'bg-blue-200', thickness: '60µm' }
                    ],
                    sustainabilityScore: 60,
                    recyclabilityScore: 65,
                    carbonFootprint: 'Medium',
                    bestFor: 'Cost-effective packaging for shorter shelf-life products'
                });
            }
            
            // Add options for confectionery and chocolate
            if (formData.productType === 'confectionery' || formData.productType === 'candy') {
                recommendations.push({
                    name: 'BOPP/VMCPP Structure',
                    barrier: 'Medium',
                    cost: 'Medium-Low',
                    sustainability: 'Medium',
                    properties: {
                        otr: '100-200',
                        wvtr: '1-5',
                        density: '0.91',
                        thickness: '60-80',
                        printQuality: 'Excellent',
                        recyclability: 'Moderate'
                    },
                    structure: [
                        { name: 'BOPP', color: 'bg-blue-400', thickness: '20µm' },
                        { name: 'Ink', color: 'bg-gray-800', thickness: '<1µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'VMCPP', color: 'bg-blue-300', thickness: '30µm' }
                    ],
                    sustainabilityScore: 55,
                    recyclabilityScore: 60,
                    carbonFootprint: 'Medium',
                    bestFor: 'Confectionery, candy, and snack food with moderate barrier needs'
                });
            }
            
            // Add sustainable option
            if (formData.sustainability === 'high') {
                recommendations.push({
                    name: 'PLA/PBAT Biodegradable Film',
                    barrier: 'Low',
                    cost: 'Medium-High',
                    sustainability: 'Very High',
                    properties: {
                        otr: '500-1000',
                        wvtr: '20-30',
                        density: '1.25',
                        thickness: '80-100',
                        printQuality: 'Moderate',
                        recyclability: 'Compostable'
                    },
                    structure: [
                        { name: 'PLA', color: 'bg-green-400', thickness: '30µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PBAT', color: 'bg-green-600', thickness: '50µm' }
                    ],
                    sustainabilityScore: 90,
                    recyclabilityScore: 85,
                    carbonFootprint: 'Very Low',
                    bestFor: 'Eco-friendly packaging for dry, short shelf-life products'
                });
            }

            // Add option for hot fill applications
            if (formData.storageCondition === 'hot') {
                recommendations.push({
                    name: 'PET/Foil/CPP Structure',
                    barrier: 'Very High',
                    cost: 'High',
                    sustainability: 'Low',
                    properties: {
                        otr: '<0.01',
                        wvtr: '<0.01',
                        density: '1.45',
                        thickness: '110-130',
                        printQuality: 'Excellent',
                        heatResistance: 'Up to 120°C',
                        recyclability: 'Difficult'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'Aluminum Foil', color: 'bg-gray-500', thickness: '7µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'CPP', color: 'bg-blue-300', thickness: '70µm' }
                    ],
                    sustainabilityScore: 20,
                    recyclabilityScore: 15,
                    carbonFootprint: 'Very High',
                    bestFor: 'Hot-fill applications, retort packaging, sauces'
                });
            }
            
            // Add options for retort packaging
            if (formData.retortable) {
                recommendations.push({
                    name: 'PET/Aluminium/CPP Retort Structure',
                    barrier: 'Very High',
                    cost: 'High',
                    sustainability: 'Low',
                    properties: {
                        otr: '<0.01',
                        wvtr: '<0.01',
                        density: '1.5',
                        thickness: '120-140',
                        printQuality: 'Excellent',
                        heatResistance: 'Up to 130°C',
                        recyclability: 'Difficult'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'Aluminum', color: 'bg-gray-500', thickness: '9µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'CPP', color: 'bg-blue-300', thickness: '70µm' }
                    ],
                    sustainabilityScore: 20,
                    recyclabilityScore: 15,
                    carbonFootprint: 'Very High',
                    bestFor: 'Ready meals, pet food, retort applications'
                });
            }
            
            // Add options for pharmaceutical products
            if (formData.productType === 'pharmaceutical') {
                recommendations.push({
                    name: 'PET/Aluminum/PE Pharma Grade',
                    barrier: 'Ultra High',
                    cost: 'Very High',
                    sustainability: 'Low',
                    properties: {
                        otr: '<0.001',
                        wvtr: '<0.001',
                        density: '1.5',
                        thickness: '110-130',
                        printQuality: 'Excellent',
                        recyclability: 'Difficult'
                    },
                    structure: [
                        { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'Aluminum', color: 'bg-gray-500', thickness: '9µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'PE', color: 'bg-blue-300', thickness: '50µm' }
                    ],
                    sustainabilityScore: 15,
                    recyclabilityScore: 10,
                    carbonFootprint: 'Very High',
                    bestFor: 'Pharmaceutical products requiring absolute barrier protection'
                });
            }
            
            // Option for microwavable applications
            if (formData.microwavable) {
                recommendations.push({
                    name: 'BOPA/CPP Microwavable Structure',
                    barrier: 'Medium',
                    cost: 'Medium',
                    sustainability: 'Medium',
                    properties: {
                        otr: '20-50',
                        wvtr: '10-20',
                        density: '1.1',
                        thickness: '70-90',
                        printQuality: 'Good',
                        heatResistance: 'Microwave Safe',
                        recyclability: 'Moderate'
                    },
                    structure: [
                        { name: 'BOPA', color: 'bg-purple-600', thickness: '15µm' },
                        { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                        { name: 'CPP', color: 'bg-blue-300', thickness: '70µm' }
                    ],
                    sustainabilityScore: 45,
                    recyclabilityScore: 40,
                    carbonFootprint: 'Medium',
                    bestFor: 'Microwavable food applications, ready meals'
                });
            }
            
            // If no specific recommendations match, add generic ones
            if (recommendations.length === 0) {
                recommendations = [
                    {
                        name: 'BOPP/CPP Structure',
                        barrier: 'Low-Medium',
                        cost: 'Low',
                        sustainability: 'Medium',
                        properties: {
                            otr: '1000-2000',
                            wvtr: '5-10',
                            density: '0.9',
                            thickness: '50-70',
                            printQuality: 'Good',
                            recyclability: 'Moderate'
                        },
                        structure: [
                            { name: 'BOPP', color: 'bg-blue-400', thickness: '20µm' },
                            { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                            { name: 'CPP', color: 'bg-blue-300', thickness: '30µm' }
                        ],
                        sustainabilityScore: 50,
                        recyclabilityScore: 55,
                        carbonFootprint: 'Medium',
                        bestFor: 'General purpose packaging for dry products'
                    },
                    {
                        name: 'PET/Aluminum/PE',
                        barrier: 'Very High',
                        cost: 'High',
                        sustainability: 'Low',
                        properties: {
                            otr: '<0.01',
                            wvtr: '<0.01',
                            density: '1.5',
                            thickness: '100-120',
                            printQuality: 'Excellent',
                            recyclability: 'Difficult'
                        },
                        structure: [
                            { name: 'PET', color: 'bg-blue-600', thickness: '12µm' },
                            { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                            { name: 'Aluminum', color: 'bg-gray-500', thickness: '7µm' },
                            { name: 'Adhesive', color: 'bg-yellow-400', thickness: '2µm' },
                            { name: 'PE', color: 'bg-blue-300', thickness: '50µm' }
                        ],
                        sustainabilityScore: 25,
                        recyclabilityScore: 20,
                        carbonFootprint: 'Very High',
                        bestFor: 'Maximum barrier for pharmaceuticals, coffee, sensitive products'
                    }
                ];
            }
            
            return recommendations;
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';
            selectedMaterials = recommendations;

            recommendations.forEach((material, index) => {
                const div = document.createElement('div');
                div.className = 'bg-gradient-to-r from-gray-50 to-white p-5 rounded-lg shadow-sm hover:shadow-md transition material-preview border-l-4 ' + (index === 0 ? 'border-blue-500' : 'border-transparent');
                div.dataset.index = index;
                
                // Generate sustainability badge based on score
                let sustainabilityBadge = '';
                if (material.sustainabilityScore >= 80) {
                    sustainabilityBadge = '<span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded ml-2"><i class="bi bi-leaf mr-1"></i>Eco-Friendly</span>';
                } else if (material.sustainabilityScore >= 60) {
                    sustainabilityBadge = '<span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded ml-2"><i class="bi bi-shield-check mr-1"></i>Standard</span>';
                } else {
                    sustainabilityBadge = '<span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded ml-2"><i class="bi bi-exclamation-triangle mr-1"></i>Review</span>';
                }
                
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-lg flex items-center">${index + 1}. ${material.name}${sustainabilityBadge}</h3>
                        <div class="flex space-x-2">
                            <button class="bg-blue-100 text-blue-700 p-1 rounded hover:bg-blue-200 view-details-btn">
                                <i class="bi bi-info-circle"></i>
                            </button>
                            <button class="bg-green-100 text-green-700 p-1 rounded hover:bg-green-200 add-compare-btn">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-3 text-sm">
                        <div class="flex items-center">
                            <i class="bi bi-shield text-blue-600 mr-2"></i>
                            <span class="text-gray-600">Barrier:</span>
                            <span class="ml-1 font-medium">${material.barrier}</span>
                        </div>
                        <div class="flex items-center">
                            <i class="bi bi-currency-dollar text-green-600 mr-2"></i>
                            <span class="text-gray-600">Cost:</span>
                            <span class="ml-1 font-medium">${material.cost}</span>
                        </div>
                        <div class="flex items-center">
                            <i class="bi bi-recycle text-teal-600 mr-2"></i>
                            <span class="text-gray-600">Sustainability:</span>
                            <span class="ml-1 font-medium">${material.sustainability}</span>
                        </div>
                        <div class="flex items-center">
                            <i class="bi bi-printer text-purple-600 mr-2"></i>
                            <span class="text-gray-600">Printability:</span>
                            <span class="ml-1 font-medium">${material.properties.printQuality}</span>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-sm grid grid-cols-2 gap-x-4 gap-y-1">
                        <div>OTR: <span class="font-medium">${material.properties.otr}</span> cc/m²/24 hr</div>
                        <div>WVTR: <span class="font-medium">${material.properties.wvtr}</span> g/m²/24 hr</div>
                        <div>Density: <span class="font-medium">${material.properties.density}</span> g/cm³</div>
                        <div>Thickness: <span class="font-medium">${material.properties.thickness}</span> µm</div>
                    </div>
                    
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <span class="text-xs text-gray-500">Best For:</span>
                        <p class="text-sm">${material.bestFor}</p>
                    </div>
                `;
                
                container.appendChild(div);
                
                // Add event listener to select this recommendation
                div.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    selectMaterial(index);
                });
            });
            
            // Select first recommendation by default
            activeMaterialIndex = 0;
            highlightSelectedMaterial();
        }

        function selectMaterial(index) {
            activeMaterialIndex = index;
            highlightSelectedMaterial();
            displayPackagePreview(selectedMaterials[index]);
            displaySustainabilityAnalysis(selectedMaterials[index]);
        }

        function highlightSelectedMaterial() {
            const items = document.querySelectorAll('#recommendations > div');
            items.forEach((item, i) => {
                if (i === activeMaterialIndex) {
                    item.classList.add('border-blue-500');
                    item.classList.remove('border-transparent');
                } else {
                    item.classList.remove('border-blue-500');
                    item.classList.add('border-transparent');
                }
            });
        }

        function displayPackagePreview(material) {
            const container = document.getElementById('packagePreview');
            
            // Determine colors based on the material type
            let mainColor, accentColor;
            if (material.name.includes('PET')) {
                mainColor = 'from-blue-400 to-blue-500';
                accentColor = 'blue';
            } else if (material.name.includes('Paper')) {
                mainColor = 'from-yellow-100 to-yellow-300';
                accentColor = 'yellow';
            } else if (material.name.includes('BOPA')) {
                mainColor = 'from-purple-400 to-purple-500';
                accentColor = 'purple';
            } else if (material.name.includes('PLA')) {
                mainColor = 'from-green-400 to-green-500';
                accentColor = 'green';
            } else if (material.name.includes('BOPP')) {
                mainColor = 'from-blue-300 to-blue-400';
                accentColor = 'blue';
            } else if (material.name.includes('Aluminum') || material.name.includes('Foil')) {
                mainColor = 'from-gray-300 to-gray-400';
                accentColor = 'gray';
            } else {
                mainColor = 'from-indigo-400 to-indigo-500';
                accentColor = 'indigo';
            }
            
            container.innerHTML = `
                <div class="package-3d bg-gradient-to-br from-${accentColor}-50 to-${accentColor}-100 p-6 rounded-lg text-center">
                    <h3 class="font-bold mb-3 text-${accentColor}-800">Front View</h3>
                    <div class="packaging-preview h-52 bg-gradient-to-r ${mainColor} rounded-lg shadow-lg flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-white opacity-20 flex flex-col items-center justify-center">
                            <div class="w-3/4 h-1/3 border-2 border-white rounded-lg"></div>
                        </div>
                        <div class="z-10 text-white text-lg font-bold">Product</div>
                    </div>
                    <p class="mt-2 text-xs text-gray-500">Stand-up pouch with ${material.name}</p>
                </div>
                <div class="package-3d bg-gradient-to-br from-${accentColor}-50 to-${accentColor}-100 p-6 rounded-lg text-center">
                    <h3 class="font-bold mb-3 text-${accentColor}-800">Side View</h3>
                    <div class="packaging-preview h-52 bg-gradient-to-r ${mainColor} rounded-lg shadow-lg" style="width: 50%; margin: 0 auto;">
                        <div class="h-full w-full flex items-center justify-center relative">
                            <div class="absolute inset-0 opacity-10 bg-white"></div>
                            <div class="z-10 text-white transform -rotate-90 text-sm font-bold">Product Side</div>
                        </div>
                    </div>
                    <p class="mt-2 text-xs text-gray-500">Side profile with gusset bottom</p>
                </div>
                <div class="package-3d bg-gradient-to-br from-${accentColor}-50 to-${accentColor}-100 p-6 rounded-lg text-center">
                    <h3 class="font-bold mb-3 text-${accentColor}-800">Material Structure</h3>
                    <div class="h-52 flex flex-col justify-center space-y-1">
                        ${material.structure.map(layer => 
                            `<div class="material-layer ${layer.color} rounded" title="${layer.name}: ${layer.thickness}">${layer.name} (${layer.thickness})</div>`
                        ).join('')}
                    </div>
                    <p class="mt-2 text-xs text-gray-500">Cross-section of ${material.name}</p>
                </div>
            `;
        }

        function displaySustainabilityAnalysis(material) {
            const container = document.getElementById('sustainabilityAnalysis');
            const sustainabilityScore = material.sustainabilityScore;
            const recyclabilityScore = material.recyclabilityScore;
            
            // Determine sustainability level and recommendations
            let sustainabilityLevel, sustainabilityColor, recommendations;
            
            if (sustainabilityScore >= 80) {
                sustainabilityLevel = 'Excellent';
                sustainabilityColor = 'bg-green-500';
                recommendations = [
                    'Current material is already highly sustainable',
                    'Consider using water-based inks for printing',
                    'Promote the recyclability through on-pack communications'
                ];
            } else if (sustainabilityScore >= 60) {
                sustainabilityLevel = 'Good';
                sustainabilityColor = 'bg-blue-500';
                recommendations = [
                    'Reduce structure thickness where possible',
                    'Explore mono-material alternatives to improve recyclability',
                    'Consider adding recycling instructions on packaging'
                ];
            } else if (sustainabilityScore >= 40) {
                sustainabilityLevel = 'Moderate';
                sustainabilityColor = 'bg-yellow-500';
                recommendations = [
                    'Consider replacing metallized layers with high-barrier coatings',
                    'Explore PE/PE or PET/PET structures for better recyclability',
                    'Optimize material usage to reduce overall environmental impact'
                ];
            } else {
                sustainabilityLevel = 'Needs Improvement';
                sustainabilityColor = 'bg-red-500';
                recommendations = [
                    'Replace aluminum layers with metalized films where barrier allows',
                    'Consider paper-based alternatives for non-barrier applications',
                    'Evaluate if barrier requirements can be reduced to enable more sustainable materials'
                ];
            }
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-medium text-lg mb-2">Sustainability Score</h3>
                        <div class="flex items-center">
                            <div class="w-16 h-16 rounded-full border-4 border-gray-100 flex items-center justify-center mr-3">
                                <span class="text-xl font-bold">${sustainabilityScore}%</span>
                            </div>
                            <div>
                                <span class="font-medium text-lg">${sustainabilityLevel}</span>
                                <div class="h-2 bg-gray-200 rounded-full mt-2 w-48">
                                    <div class="${sustainabilityColor} h-2 rounded-full" style="width: ${sustainabilityScore}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-medium text-lg mb-2">Environmental Impact</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Carbon Footprint</span>
                                    <span>${material.carbonFootprint}</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="${material.carbonFootprint === 'Very High' ? 'bg-red-500' : material.carbonFootprint === 'High' ? 'bg-orange-500' : material.carbonFootprint === 'Medium' ? 'bg-yellow-500' : 'bg-green-500'} h-2 rounded-full" 
                                        style="width: ${material.carbonFootprint === 'Very High' ? '90%' : material.carbonFootprint === 'High' ? '70%' : material.carbonFootprint === 'Medium' ? '50%' : '30%'}"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Recyclability</span>
                                    <span>${recyclabilityScore}%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="bg-blue-500 h-2 rounded-full" style="width: ${recyclabilityScore}%"></div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Resource Efficiency</span>
                                    <span>${Math.min(100, Math.max(20, 120 - parseInt(material.properties.thickness.split('-')[0])))}%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="bg-teal-500 h-2 rounded-full" style="width: ${Math.min(100, Math.max(20, 120 - parseInt(material.properties.thickness.split('-')[0])))}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                        <h3 class="font-medium text-lg mb-2">Recommendations</h3>
                        <ul class="text-sm space-y-2">
                            ${recommendations.map(rec => `
                                <li class="flex items-start">
                                    <i class="bi bi-arrow-right-circle-fill text-green-600 mr-2 mt-0.5"></i>
                                    <span>${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function show3DView() {
            const container = document.getElementById('packagePreview');
            const material = selectedMaterials[activeMaterialIndex];
            
            // Determine colors based on the material type
            let mainColor, textColor;
            if (material.name.includes('PET')) {
                mainColor = 'from-blue-400 to-blue-500';
                textColor = 'text-blue-800';
            } else if (material.name.includes('Paper')) {
                mainColor = 'from-yellow-100 to-yellow-300';
                textColor = 'text-yellow-800';
            } else if (material.name.includes('BOPA')) {
                mainColor = 'from-purple-400 to-purple-500';
                textColor = 'text-purple-800';
            } else if (material.name.includes('PLA')) {
                mainColor = 'from-green-400 to-green-500';
                textColor = 'text-green-800';
            } else if (material.name.includes('BOPP')) {
                mainColor = 'from-blue-300 to-blue-400';
                textColor = 'text-blue-700';
            } else if (material.name.includes('Aluminum') || material.name.includes('Foil')) {
                mainColor = 'from-gray-300 to-gray-400';
                textColor = 'text-gray-800';
            } else {
                mainColor = 'from-indigo-400 to-indigo-500';
                textColor = 'text-indigo-800';
            }
            
            container.innerHTML = `
                <div class="col-span-2 packaging-preview bg-gradient-to-br from-gray-50 to-blue-50 p-8 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-4 text-xl text-center ${textColor}">3D Package Visualization</h3>
                    <div class="h-64 bg-gradient-to-r ${mainColor} rounded-lg shadow-xl flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-white opacity-10 flex flex-col items-center justify-center">
                            <div class="w-3/4 h-1/2 border-2 border-white rounded-lg flex items-center justify-center">
                                <div class="text-white text-2xl font-bold">PRODUCT</div>
                            </div>
                        </div>
                        <div class="absolute bottom-3 right-3 bg-white bg-opacity-20 px-3 py-1 rounded text-white text-xs">
                            ${material.name}
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-gray-50 to-blue-50 p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-3 text-center ${textColor}">Specifications</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Structure:</span>
                            <span class="font-medium">${material.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Total Thickness:</span>
                            <span class="font-medium">${material.properties.thickness} µm</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Barrier Level:</span>
                            <span class="font-medium">${material.barrier}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Sealing Temp:</span>
                            <span class="font-medium">120-140°C</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Yield:</span>
                            <span class="font-medium">${Math.round(1000000/(material.properties.density * parseInt(material.properties.thickness.split('-')[0])))} m²/kg</span>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <h4 class="font-medium mb-1">Features</h4>
                        <ul class="text-sm space-y-1">
                            <li class="flex items-center">
                                <i class="bi bi-check-circle-fill text-green-600 mr-2"></i>
                                <span>Excellent printability</span>
                            </li>
                            <li class="flex items-center">
                                <i class="bi bi-check-circle-fill text-green-600 mr-2"></i>
                                <span>High puncture resistance</span>
                            </li>
                            <li class="flex items-center">
                                <i class="bi bi-check-circle-fill text-green-600 mr-2"></i>
                                <span>Good machinability</span>
                            </li>
                            ${material.properties.heatResistance ? `
                            <li class="flex items-center">
                                <i class="bi bi-check-circle-fill text-green-600 mr-2"></i>
                                <span>Heat resistance: ${material.properties.heatResistance}</span>
                            </li>` : ''}
                        </ul>
                    </div>
                </div>
            `;
        }

        function showTechnicalView() {
            const container = document.getElementById('packagePreview');
            const material = selectedMaterials[activeMaterialIndex];
            
            const colorMap = {
                'Very High': 'bg-green-600',
                'High': 'bg-green-500',
                'Medium': 'bg-yellow-500',
                'Low': 'bg-red-500',
                'Very Low': 'bg-red-600'
            };
            
            container.innerHTML = `
                <div class="col-span-3 bg-gradient-to-br from-gray-50 to-blue-50 p-6 rounded-lg shadow-lg">
                    <h3 class="font-bold mb-4 text-xl text-center">Technical Specifications</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium mb-3">Material Structure</h4>
                            <div class="space-y-1">
                                ${material.structure.map(layer => 
                                    `<div class="flex justify-between p-2 border border-gray-100 rounded">
                                        <span class="font-medium">${layer.name}</span>
                                        <span>${layer.thickness}</span>
                                    </div>`
                                ).join('')}
                                <div class="flex justify-between p-2 border border-gray-100 rounded bg-gray-50">
                                    <span class="font-medium">Total Thickness</span>
                                    <span>${material.properties.thickness} µm</span>
                                </div>
                            </div>
                            
                            <h4 class="font-medium mt-4 mb-3">Process Parameters</h4>
                            <div class="space-y-1">
                                <div class="flex justify-between p-2 border border-gray-100 rounded">
                                    <span>Sealing Temperature</span>
                                    <span>120-140°C</span>
                                </div>
                                <div class="flex justify-between p-2 border border-gray-100 rounded">
                                    <span>Sealing Pressure</span>
                                    <span>Medium-High</span>
                                </div>
                                <div class="flex justify-between p-2 border border-gray-100 rounded">
                                    <span>Sealing Time</span>
                                    <span>0.5-1.0s</span>
                                </div>
                                ${material.properties.heatResistance ? `
                                <div class="flex justify-between p-2 border border-gray-100 rounded">
                                    <span>Heat Resistance</span>
                                    <span>${material.properties.heatResistance}</span>
                                </div>` : ''}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium mb-3">Barrier Properties</h4>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span>Oxygen Transmission Rate</span>
                                        <span>${material.properties.otr} cc/m²/24h</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 rounded-full">
                                        <div class="${colorMap[material.barrier] || 'bg-yellow-500'} h-2 rounded-full" style="width: ${
                                            material.barrier === 'Very High' || material.barrier === 'Ultra High' ? '90%' : 
                                            material.barrier === 'High' ? '75%' : 
                                            material.barrier === 'Medium' ? '50%' : 
                                            material.barrier === 'Low' ? '25%' : '10%'
                                        }"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span>Water Vapor Transmission Rate</span>
                                        <span>${material.properties.wvtr} g/m²/24h</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 rounded-full">
                                        <div class="${colorMap[material.barrier] || 'bg-yellow-500'} h-2 rounded-full" style="width: ${
                                            material.barrier === 'Very High' || material.barrier === 'Ultra High' ? '90%' : 
                                            material.barrier === 'High' ? '75%' : 
                                            material.barrier === 'Medium' ? '50%' : 
                                            material.barrier === 'Low' ? '25%' : '10%'
                                        }"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span>Light Barrier</span>
                                        <span>${
                                            material.name.includes('Met') || material.name.includes('Aluminum') || material.name.includes('Foil') ? 'Excellent' :
                                            material.name.includes('EVOH') ? 'Good' : 'Moderate'
                                        }</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 rounded-full">
                                        <div class="${
                                            material.name.includes('Met') || material.name.includes('Aluminum') || material.name.includes('Foil') ? 'bg-green-500' :
                                            material.name.includes('EVOH') ? 'bg-yellow-500' : 'bg-orange-500'
                                        } h-2 rounded-full" style="width: ${
                                            material.name.includes('Met') || material.name.includes('Aluminum') || material.name.includes('Foil') ? '90%' :
                                            material.name.includes('EVOH') ? '70%' : '50%'
                                        }"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <h4 class="font-medium mt-4 mb-3">Mechanical Properties</h4>
                            <div class="space-y-3">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span>Puncture Resistance</span>
                                        <span>${
                                            material.name.includes('PET') || material.name.includes('Nylon') || material.name.includes('BOPA') ? 'Excellent' :
                                            material.name.includes('PE') ? 'Good' : 'Moderate'
                                        }</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 rounded-full">
                                        <div class="${
                                            material.name.includes('PET') || material.name.includes('Nylon') || material.name.includes('BOPA') ? 'bg-green-500' :
                                            material.name.includes('PE') ? 'bg-yellow-500' : 'bg-orange-500'
                                        } h-2 rounded-full" style="width: ${
                                            material.name.includes('PET') || material.name.includes('Nylon') || material.name.includes('BOPA') ? '90%' :
                                            material.name.includes('PE') ? '70%' : '50%'
                                        }"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span>Tear Resistance</span>
                                        <span>${
                                            material.name.includes('PET') || material.name.includes('BOPP') ? 'Excellent' :
                                            material.name.includes('PE') ? 'Good' : 'Moderate'
                                        }</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 rounded-full">
                                        <div class="${
                                            material.name.includes('PET') || material.name.includes('BOPP') ? 'bg-green-500' :
                                            material.name.includes('PE') ? 'bg-yellow-500' : 'bg-orange-500'
                                        } h-2 rounded-full" style="width: ${
                                            material.name.includes('PET') || material.name.includes('BOPP') ? '90%' :
                                            material.name.includes('PE') ? '70%' : '50%'
                                        }"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function calculateSustainability() {
            // Show loading indicator
            document.getElementById('loading').style.display = 'flex';
            
            // Simulate API call delay
            setTimeout(() => {
                const material = document.getElementById('ecoMaterial').value;
                const annualProduction = parseInt(document.getElementById('annualProduction').value);
                const transportDistance = parseInt(document.getElementById('transportDistance').value);
                const endOfLife = document.getElementById('endOfLife').value;
                
                let carbonScore, waterScore, wasteScore, recyclingScore;
                
                // Calculate carbon footprint based on material type
                switch (material) {
                    case 'petpe':
                        carbonScore = Math.round(annualProduction * 2.5);
                        waterScore = Math.round(annualProduction * 12);
                        wasteScore = Math.round(annualProduction * 0.85);
                        recyclingScore = 45;
                        break;
                    case 'evohpe':
                        carbonScore = Math.round(annualProduction * 3.1);
                        waterScore = Math.round(annualProduction * 14);
                        wasteScore = Math.round(annualProduction * 0.9);
                        recyclingScore = 30;
                        break;
                    case 'metpet':
                        carbonScore = Math.round(annualProduction * 3.5);
                        waterScore = Math.round(annualProduction * 15);
                        wasteScore = Math.round(annualProduction * 0.95);
                        recyclingScore = 25;
                        break;
                    case 'paperpe':
                        carbonScore = Math.round(annualProduction * 1.6);
                        waterScore = Math.round(annualProduction * 18);
                        wasteScore = Math.round(annualProduction * 0.7);
                        recyclingScore = 65;
                        break;
                    case 'bioplastic':
                        carbonScore = Math.round(annualProduction * 1.8);
                        waterScore = Math.round(annualProduction * 16);
                        wasteScore = Math.round(annualProduction * 0.65);
                        recyclingScore = 80;
                        break;
                    case 'aluminum':
                        carbonScore = Math.round(annualProduction * 4.2);
                        waterScore = Math.round(annualProduction * 20);
                        wasteScore = Math.round(annualProduction * 1);
                        recyclingScore = 20;
                        break;
                    case 'bopape':
                        carbonScore = Math.round(annualProduction * 2.8);
                        waterScore = Math.round(annualProduction * 13);
                        wasteScore = Math.round(annualProduction * 0.85);
                        recyclingScore = 40;
                        break;
                    default:
                        carbonScore = Math.round(annualProduction * 2.5);
                        waterScore = Math.round(annualProduction * 12.5);
                        wasteScore = Math.round(annualProduction * 0.85);
                        recyclingScore = 35;
                }
                
                // Add transport emissions (simplified calculation)
                carbonScore += Math.round(annualProduction * transportDistance * 0.0001);
                
                // Adjust based on end-of-life scenario
                switch (endOfLife) {
                    case 'recycle':
                        carbonScore = Math.round(carbonScore * 0.8);
                        wasteScore = Math.round(wasteScore * 0.6);
                        break;
                    case 'compost':
                        if (material === 'bioplastic') {
                            carbonScore = Math.round(carbonScore * 0.7);
                            wasteScore = Math.round(wasteScore * 0.4);
                        }
                        break;
                    case 'incineration':
                        carbonScore = Math.round(carbonScore * 1.2);
                        wasteScore = Math.round(wasteScore * 0.3);
                        break;
                    case 'landfill':
                        carbonScore = Math.round(carbonScore * 1.1);
                        wasteScore = Math.round(wasteScore * 1.1);
                        break;
                }
                
                // Update results in the UI
                document.getElementById('carbonFootprint').innerHTML = `
                    <h4 class="font-medium mb-2">Carbon Footprint</h4>
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-bold">${carbonScore}</span>
                        <span class="text-gray-600">tons CO2 eq./year</span>
                        <span class="${carbonScore > 250 ? 'text-red-500' : 'text-green-500'} text-sm">
                            ${carbonScore > 250 ? '+' : ''}${Math.round((carbonScore - 250) / 2.5)}% vs. industry avg.
                        </span>
                    </div>
                    <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full ${carbonScore > 250 ? 'bg-red-500' : 'bg-green-500'} rounded-full" style="width: ${Math.min(100, carbonScore / 4)}%"></div>
                    </div>
                `;
                
                document.getElementById('waterUsage').innerHTML = `
                    <h4 class="font-medium mb-2">Water Usage</h4>
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-bold">${waterScore}</span>
                        <span class="text-gray-600">kL/year</span>
                        <span class="${waterScore > 1300 ? 'text-red-500' : 'text-green-500'} text-sm">
                            ${waterScore > 1300 ? '+' : ''}${Math.round((waterScore - 1300) / 13)}% vs. industry avg.
                        </span>
                    </div>
                    <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500 rounded-full" style="width: ${Math.min(100, waterScore / 25)}%"></div>
                    </div>
                `;
                
                document.getElementById('wasteGeneration').innerHTML = `
                    <h4 class="font-medium mb-2">Waste Generation</h4>
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-bold">${wasteScore}</span>
                        <span class="text-gray-600">tons/year</span>
                        <span class="${wasteScore > 85 ? 'text-red-500' : 'text-green-500'} text-sm">
                            ${wasteScore > 85 ? '+' : ''}${Math.round((wasteScore - 85) / 0.85)}% vs. industry avg.
                        </span>
                    </div>
                    <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-yellow-500 rounded-full" style="width: ${Math.min(100, wasteScore / 1.6)}%"></div>
                    </div>
                `;
                
                document.getElementById('recyclingRate').innerHTML = `
                    <h4 class="font-medium mb-2">Recyclability</h4>
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-bold">${recyclingScore}%</span>
                        <span class="text-gray-600">recovery rate</span>
                        <span class="${recyclingScore < 45 ? 'text-red-500' : 'text-green-500'} text-sm">
                            ${recyclingScore < 45 ? '' : '+'}${Math.round(recyclingScore - 45)}% vs. industry avg.
                        </span>
                    </div>
                    <div class="mt-2 h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full bg-green-500 rounded-full" style="width: ${recyclingScore}%"></div>
                    </div>
                `;
                
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        function resetForm() {
            document.getElementById('recommendationForm').reset();
            document.getElementById('recommendations').innerHTML = `
                <div class="p-8 text-center text-gray-500">
                    <i class="bi bi-arrow-left-circle text-5xl mb-4 text-blue-300"></i>
                    <p>Select your requirements on the left to get personalized material recommendations</p>
                </div>
            `;
            document.getElementById('packagePreview').innerHTML = `
                <div class="p-8 text-center text-gray-500 col-span-3">
                    <i class="bi bi-box2 text-6xl mb-4 text-gray-300"></i>
                    <p>Select a material recommendation to view package visualization</p>
                </div>
            `;
            document.getElementById('sustainabilityAnalysis').innerHTML = `
                <div class="p-8 text-center text-gray-500">
                    <i class="bi bi-recycle text-6xl mb-4 text-gray-300"></i>
                    <p>Select a material recommendation to view sustainability analysis</p>
                </div>
            `;
        }

        window.onclick = function(event) {
            const compareModal = document.getElementById('compareModal');
            const sustainabilityModal = document.getElementById('sustainabilityModal');
            const pouchGeneratorModal = document.getElementById('pouchGeneratorModal');
            
            if (event.target === compareModal) {
                compareModal.style.display = 'none';
            }
            
            if (event.target === sustainabilityModal) {
                sustainabilityModal.style.display = 'none';
            }

            if (event.target === document.getElementById('geminiModal')) {
                document.querySelector('[x-data="app()"]').__x.$data.closeGeminiModal();
            }

            if (event.target === pouchGeneratorModal) {
                document.querySelector('[x-data="app()"]').__x.$data.closePouchGeneratorModal();
            }
        };
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>